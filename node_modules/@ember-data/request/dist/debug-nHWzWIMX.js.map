{"version":3,"file":"debug-nHWzWIMX.js","sources":["../src/-private/promise-cache.ts","../src/-private/utils.ts","../src/-private/future.ts","../src/-private/context.ts","../src/-private/debug.ts"],"sourcesContent":["import { getOrSetUniversal } from '@warp-drive/core-types/-private';\n\nexport type CacheResult<T = unknown, E = unknown> = { isError: true; result: E } | { isError: false; result: T };\n\nexport type Awaitable<T = unknown, E = unknown> = {\n  then: (onFulfilled: (value: T) => unknown, onRejected: (reason: E) => unknown) => unknown;\n  catch: (onRejected: (reason: E) => unknown) => unknown;\n  finally: (onFinally: () => unknown) => unknown;\n};\n\nexport const PromiseCache = getOrSetUniversal('PromiseCache', new WeakMap<Awaitable, CacheResult>());\nexport const RequestMap = getOrSetUniversal('RequestMap', new Map<number, CacheResult>());\n\nexport function setRequestResult(requestId: number, result: CacheResult) {\n  RequestMap.set(requestId, result);\n}\nexport function clearRequestResult(requestId: number) {\n  RequestMap.delete(requestId);\n}\nexport function getRequestResult(requestId: number): CacheResult | undefined {\n  return RequestMap.get(requestId);\n}\n\nexport function setPromiseResult(promise: Promise<unknown> | Awaitable, result: CacheResult) {\n  PromiseCache.set(promise, result);\n}\n\nexport function getPromiseResult<T, E>(promise: Promise<T> | Awaitable<T, E>): CacheResult<T, E> | undefined {\n  return PromiseCache.get(promise) as CacheResult<T, E> | undefined;\n}\n","import { DEBUG } from '@warp-drive/build-config/env';\nimport { getOrSetGlobal } from '@warp-drive/core-types/-private';\nimport type {\n  RequestInfo,\n  StructuredDataDocument,\n  StructuredDocument,\n  StructuredErrorDocument,\n} from '@warp-drive/core-types/request';\nimport { STRUCTURED } from '@warp-drive/core-types/request';\n\nimport { Context, ContextOwner } from './context';\nimport { assertValidRequest } from './debug';\nimport { createFuture, isFuture } from './future';\nimport { setRequestResult } from './promise-cache';\nimport type { DeferredFuture, Future, GodContext, Handler } from './types';\n\nexport const IS_CACHE_HANDLER = getOrSetGlobal('IS_CACHE_HANDLER', Symbol('IS_CACHE_HANDLER'));\nexport function curryFuture<T>(owner: ContextOwner, inbound: Future<T>, outbound: DeferredFuture<T>): Future<T> {\n  owner.setStream(inbound.getStream());\n\n  inbound.then(\n    (doc: StructuredDataDocument<T>) => {\n      const document = {\n        [STRUCTURED]: true as const,\n        request: owner.request,\n        response: doc.response,\n        content: doc.content,\n      };\n      outbound.resolve(document);\n    },\n    (error: Error & StructuredErrorDocument) => {\n      if (isDoc(error)) {\n        owner.setStream(owner.god.stream);\n      }\n      if (!error || !(error instanceof Error)) {\n        try {\n          throw new Error(error ? error : `Request Rejected with an Unknown Error`);\n        } catch (e: unknown) {\n          if (error && typeof error === 'object') {\n            Object.assign(e as Error, error);\n            (e as Error & StructuredErrorDocument).message =\n              (error as Error).message || `Request Rejected with an Unknown Error`;\n          }\n          error = e as Error & StructuredErrorDocument;\n        }\n      }\n\n      error[STRUCTURED] = true;\n      error.request = owner.request;\n      error.response = owner.getResponse();\n      error.error = error.error || error.message;\n\n      outbound.reject(error);\n    }\n  );\n  return outbound.promise;\n}\n\nfunction isDoc<T>(doc: T | StructuredDataDocument<T>): doc is StructuredDataDocument<T> {\n  return doc && (doc as StructuredDataDocument<T>)[STRUCTURED] === true;\n}\n\nfunction ensureDoc<T>(owner: ContextOwner, content: T | Error, isError: boolean): StructuredDocument<T> {\n  if (isDoc(content)) {\n    return content as StructuredDocument<T>;\n  }\n\n  if (isError) {\n    return {\n      [STRUCTURED]: true,\n      request: owner.request,\n      response: owner.getResponse(),\n      error: content as Error,\n    } as StructuredErrorDocument<T>;\n  }\n\n  return {\n    [STRUCTURED]: true,\n    request: owner.request,\n    response: owner.getResponse(),\n    content: content as T,\n  };\n}\n\nexport interface HttpErrorProps extends DOMException {\n  code: number;\n  name: string;\n  status: number;\n  statusText: string;\n  isRequestError: boolean;\n}\n\nexport function enhanceReason(reason?: string) {\n  return new DOMException(reason || 'The user aborted a request.', 'AbortError');\n}\n\nexport function handleOutcome<T>(\n  owner: ContextOwner,\n  inbound: Promise<T | StructuredDataDocument<T>>,\n  outbound: DeferredFuture<T>\n): Future<T> {\n  inbound.then(\n    (content: T | StructuredDataDocument<T>) => {\n      if (owner.controller.signal.aborted) {\n        // the next function did not respect the signal, we handle it here\n        outbound.reject(enhanceReason(owner.controller.signal.reason as string));\n        return;\n      }\n      if (isDoc(content)) {\n        owner.setStream(owner.god.stream);\n        content = content.content;\n      }\n      const document = {\n        [STRUCTURED]: true as const,\n        request: owner.request,\n        response: owner.getResponse(),\n        content,\n      };\n      outbound.resolve(document);\n    },\n    (error: Error & StructuredErrorDocument) => {\n      if (isDoc(error)) {\n        owner.setStream(owner.god.stream);\n      }\n      if (!error || !(error instanceof Error)) {\n        try {\n          throw new Error(error ? error : `Request Rejected with an Unknown Error`);\n        } catch (e: unknown) {\n          if (error && typeof error === 'object') {\n            Object.assign(e as Error, error);\n            (e as Error & StructuredErrorDocument).message =\n              (error as Error).message || `Request Rejected with an Unknown Error`;\n          }\n          error = e as Error & StructuredErrorDocument;\n        }\n      }\n\n      error[STRUCTURED] = true;\n      error.request = owner.request;\n      error.response = owner.getResponse();\n      error.error = error.error || error.message;\n      outbound.reject(error);\n    }\n  );\n  return outbound.promise;\n}\n\nfunction isCacheHandler(handler: Handler & { [IS_CACHE_HANDLER]?: boolean }, index: number): boolean {\n  return index === 0 && Boolean(handler[IS_CACHE_HANDLER]);\n}\n\nexport function executeNextHandler<T>(\n  wares: Readonly<Handler[]>,\n  request: RequestInfo,\n  i: number,\n  god: GodContext\n): Future<T> {\n  if (DEBUG) {\n    if (i === wares.length) {\n      throw new Error(`No handler was able to handle this request.`);\n    }\n    assertValidRequest(request, false);\n  }\n  const owner = new ContextOwner(request, god, i === 0);\n\n  function next(r: RequestInfo): Future<T> {\n    owner.nextCalled++;\n    return executeNextHandler(wares, r, i + 1, god);\n  }\n\n  const _isCacheHandler = isCacheHandler(wares[i], i);\n  const context = new Context(owner, _isCacheHandler);\n  let outcome: Promise<T | StructuredDataDocument<T>> | Future<T>;\n  try {\n    outcome = wares[i].request<T>(context, next);\n    if (_isCacheHandler) {\n      context._finalize();\n    }\n    if (!!outcome && _isCacheHandler) {\n      if (!(outcome instanceof Promise)) {\n        setRequestResult(owner.requestId, { isError: false, result: ensureDoc(owner, outcome, false) });\n        outcome = Promise.resolve(outcome);\n      }\n    } else if (DEBUG) {\n      if (!outcome || (!(outcome instanceof Promise) && !(typeof outcome === 'object' && 'then' in outcome))) {\n        // eslint-disable-next-line no-console\n        console.log({ request, handler: wares[i], outcome });\n        if (outcome === undefined) {\n          throw new Error(`Expected handler.request to return a promise, instead received undefined.`);\n        }\n        throw new Error(`Expected handler.request to return a promise, instead received a synchronous value.`);\n      }\n    }\n  } catch (e) {\n    if (_isCacheHandler) {\n      setRequestResult(owner.requestId, { isError: true, result: ensureDoc(owner, e, true) });\n    }\n    // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors\n    outcome = Promise.reject<StructuredDataDocument<T>>(e);\n  }\n  const future = createFuture<T>(owner);\n\n  if (isFuture<T>(outcome)) {\n    return curryFuture(owner, outcome, future);\n  }\n\n  return handleOutcome(owner, outcome, future);\n}\n","import { IS_FUTURE, type StructuredDocument } from '@warp-drive/core-types/request';\n\nimport type { ContextOwner } from './context';\nimport type { Deferred, DeferredFuture, Future } from './types';\nimport { enhanceReason } from './utils';\n\nexport function isFuture<T>(maybe: unknown): maybe is Future<T> {\n  return Boolean(maybe && maybe instanceof Promise && (maybe as Future<T>)[IS_FUTURE] === true);\n}\n\nexport function createDeferred<T>(): Deferred<T> {\n  let resolve!: (v: T) => void;\n  let reject!: (v: unknown) => void;\n  const promise = new Promise<T>((res, rej) => {\n    resolve = res;\n    reject = rej;\n  });\n  return { resolve, reject, promise };\n}\n\nexport function upgradePromise<T>(promise: Promise<StructuredDocument<T>>, future: Future<T>): Future<T> {\n  (promise as Future<T>)[IS_FUTURE] = true;\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  (promise as Future<T>).getStream = future.getStream;\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  (promise as Future<T>).abort = future.abort;\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  (promise as Future<T>).onFinalize = future.onFinalize;\n  (promise as Future<T>).id = future.id;\n  (promise as Future<T>).lid = future.lid;\n\n  return promise as Future<T>;\n}\n\nexport function createFuture<T>(owner: ContextOwner): DeferredFuture<T> {\n  const deferred = createDeferred<T>() as unknown as DeferredFuture<T>;\n  let { promise } = deferred;\n  let cbs: Array<() => void> | undefined;\n  promise = promise.finally(() => {\n    owner.resolveStream();\n    if (cbs) {\n      cbs.forEach((cb) => cb());\n    }\n  }) as Future<T>;\n  promise.onFinalize = (fn: () => void) => {\n    cbs = cbs || [];\n    cbs.push(fn);\n  };\n  promise[IS_FUTURE] = true;\n  promise.getStream = () => {\n    return owner.getStream();\n  };\n  promise.abort = (reason?: string) => {\n    owner.abort(enhanceReason(reason));\n  };\n  promise.id = owner.requestId;\n  promise.lid = owner.god.identifier;\n\n  deferred.promise = promise;\n  return deferred;\n}\n","import { DEBUG } from '@warp-drive/build-config/env';\nimport { assert } from '@warp-drive/build-config/macros';\nimport type { StableDocumentIdentifier } from '@warp-drive/core-types/identifier';\nimport type { ImmutableHeaders, ImmutableRequestInfo, RequestInfo, ResponseInfo } from '@warp-drive/core-types/request';\nimport { SkipCache } from '@warp-drive/core-types/request';\n\nimport { deepFreeze } from './debug';\nimport { createDeferred } from './future';\nimport type { DeferredStream, GodContext } from './types';\n\nexport function upgradeHeaders(headers: Headers | ImmutableHeaders): ImmutableHeaders {\n  (headers as ImmutableHeaders).clone = () => {\n    return new Headers(headers);\n  };\n  (headers as ImmutableHeaders).toJSON = () => {\n    return Array.from(headers as unknown as Iterable<[string, string]>);\n  };\n  return headers as ImmutableHeaders;\n}\n\nexport function cloneResponseProperties(response: Response): ResponseInfo {\n  const { headers, ok, redirected, status, statusText, type, url } = response;\n  upgradeHeaders(headers);\n  return {\n    headers: headers as ImmutableHeaders,\n    ok,\n    redirected,\n    status,\n    statusText,\n    type,\n    url,\n  };\n}\n\nexport class ContextOwner {\n  hasSetStream = false;\n  hasSetResponse = false;\n  hasSubscribers = false;\n  stream: DeferredStream = createDeferred<ReadableStream | null>();\n  response: ResponseInfo | null = null;\n  declare request: ImmutableRequestInfo;\n  declare enhancedRequest: ImmutableRequestInfo;\n  nextCalled = 0;\n  declare god: GodContext;\n  declare controller: AbortController;\n  declare requestId: number;\n  declare isRoot: boolean;\n\n  constructor(request: RequestInfo, god: GodContext, isRoot = false) {\n    this.isRoot = isRoot;\n    this.requestId = god.id;\n    this.controller = request.controller || god.controller;\n    this.stream.promise.sizeHint = 0;\n\n    if (request.controller) {\n      if (request.controller !== god.controller) {\n        god.controller.signal.addEventListener('abort', () => {\n          this.controller.abort(god.controller.signal.reason);\n        });\n      }\n      delete request.controller;\n    }\n    let enhancedRequest: ImmutableRequestInfo = Object.assign(\n      { signal: this.controller.signal },\n      request\n    ) as ImmutableRequestInfo;\n    if (DEBUG) {\n      if (!request?.cacheOptions?.[SkipCache]) {\n        request = deepFreeze(request) as ImmutableRequestInfo;\n        enhancedRequest = deepFreeze(enhancedRequest);\n      }\n    } else {\n      if (request.headers) {\n        upgradeHeaders(request.headers);\n      }\n    }\n    this.enhancedRequest = enhancedRequest;\n    this.request = request as ImmutableRequestInfo;\n    this.god = god;\n    this.stream.promise = this.stream.promise.then((stream: ReadableStream | null) => {\n      if (this.god.stream === stream && this.hasSubscribers) {\n        this.god.stream = null;\n      }\n      return stream;\n    });\n  }\n\n  get hasRequestedStream(): boolean {\n    return this.god.hasRequestedStream;\n  }\n\n  getResponse(): ResponseInfo | null {\n    if (this.hasSetResponse) {\n      return this.response;\n    }\n    if (this.nextCalled === 1) {\n      return this.god.response;\n    }\n    return null;\n  }\n  getStream(): Promise<ReadableStream | null> {\n    if (this.isRoot) {\n      this.god.hasRequestedStream = true;\n    }\n    if (!this.hasSetResponse) {\n      const hint = this.god.response?.headers?.get('content-length');\n      this.stream.promise.sizeHint = hint ? parseInt(hint, 10) : 0;\n    }\n    this.hasSubscribers = true;\n    return this.stream.promise;\n  }\n  abort(reason: DOMException) {\n    this.controller.abort(reason);\n  }\n\n  setStream(stream: ReadableStream | Promise<ReadableStream | null> | null) {\n    if (!this.hasSetStream) {\n      this.hasSetStream = true;\n\n      if (!(stream instanceof Promise)) {\n        this.god.stream = stream;\n      }\n      // @ts-expect-error\n      this.stream.resolve(stream);\n    }\n  }\n\n  resolveStream() {\n    this.setStream(this.nextCalled === 1 ? this.god.stream : null);\n  }\n\n  setResponse(response: ResponseInfo | Response | null) {\n    if (this.hasSetResponse) {\n      if (DEBUG) {\n        throw new Error(`Cannot setResponse when a response has already been set`);\n      }\n      return;\n    }\n    this.hasSetResponse = true;\n    if (response instanceof Response) {\n      // TODO potentially avoid cloning in prod\n      let responseData = cloneResponseProperties(response);\n\n      if (DEBUG) {\n        responseData = deepFreeze(responseData);\n      }\n      this.response = responseData;\n      this.god.response = responseData;\n      const sizeHint = response.headers?.get('content-length');\n      this.stream.promise.sizeHint = sizeHint ? parseInt(sizeHint, 10) : 0;\n    } else {\n      this.response = response;\n      this.god.response = response;\n    }\n  }\n}\n\nexport class Context {\n  #owner: ContextOwner;\n  declare request: ImmutableRequestInfo;\n  declare id: number;\n  declare private _isCacheHandler: boolean;\n  declare private _finalized: boolean;\n\n  constructor(owner: ContextOwner, isCacheHandler: boolean) {\n    this.id = owner.requestId;\n    this.#owner = owner;\n    this.request = owner.enhancedRequest;\n    this._isCacheHandler = isCacheHandler;\n    this._finalized = false;\n  }\n  setStream(stream: ReadableStream | Promise<ReadableStream | null>) {\n    this.#owner.setStream(stream);\n  }\n  setResponse(response: ResponseInfo | Response | null) {\n    this.#owner.setResponse(response);\n  }\n\n  setIdentifier(identifier: StableDocumentIdentifier) {\n    assert(\n      `setIdentifier may only be used synchronously from a CacheHandler`,\n      identifier && this._isCacheHandler && !this._finalized\n    );\n    this.#owner.god.identifier = identifier;\n  }\n\n  get hasRequestedStream() {\n    return this.#owner.hasRequestedStream;\n  }\n\n  _finalize() {\n    this._finalized = true;\n  }\n}\nexport type HandlerRequestContext = Context;\n","import { DEBUG } from '@warp-drive/build-config/env';\nimport { getOrSetGlobal } from '@warp-drive/core-types/-private';\nimport type { ImmutableHeaders, RequestInfo } from '@warp-drive/core-types/request';\n\nimport { Context, upgradeHeaders } from './context';\n\nconst BODY_TYPES = {\n  type: 'string',\n  klass: ['Blob', 'ArrayBuffer', 'TypedArray', 'DataView', 'FormData', 'URLSearchParams', 'ReadableStream'],\n};\nconst ValidKeys = new Map<string, string | string[] | typeof BODY_TYPES>([\n  ['records', 'array'],\n  ['data', 'json'],\n  ['body', BODY_TYPES],\n  ['disableTestWaiter', 'boolean'],\n  ['options', 'object'],\n  ['cacheOptions', 'object'],\n  ['op', 'string'],\n  ['store', 'object'],\n  ['url', 'string'],\n  ['cache', ['default', 'force-cache', 'no-cache', 'no-store', 'only-if-cached', 'reload']],\n  ['credentials', ['include', 'omit', 'same-origin']],\n  [\n    'destination',\n    [\n      '',\n      'object',\n      'audio',\n      'audioworklet',\n      'document',\n      'embed',\n      'font',\n      'frame',\n      'iframe',\n      'image',\n      'manifest',\n      'paintworklet',\n      'report',\n      'script',\n      'sharedworker',\n      'style',\n      'track',\n      'video',\n      'worker',\n      'xslt',\n    ],\n  ],\n  ['headers', 'headers'],\n  ['integrity', 'string'],\n  ['keepalive', 'boolean'],\n  ['method', ['QUERY', 'GET', 'PUT', 'PATCH', 'DELETE', 'POST', 'OPTIONS', 'HEAD', 'CONNECT', 'TRACE']],\n  ['mode', ['same-origin', 'cors', 'navigate', 'no-cors']],\n  ['redirect', ['error', 'follow', 'manual']],\n  ['referrer', 'string'],\n  ['signal', 'AbortSignal'],\n  ['controller', 'AbortController'],\n  [\n    'referrerPolicy',\n    [\n      '',\n      'same-origin',\n      'no-referrer',\n      'no-referrer-when-downgrade',\n      'origin',\n      'origin-when-cross-origin',\n      'strict-origin',\n      'strict-origin-when-cross-origin',\n      'unsafe-url',\n    ],\n  ],\n]);\n\nconst IS_FROZEN = getOrSetGlobal('IS_FROZEN', Symbol('FROZEN'));\nconst IS_COLLECTION = getOrSetGlobal('IS_COLLECTION', Symbol.for('Collection'));\n\nfunction freezeHeaders(headers: Headers | ImmutableHeaders): ImmutableHeaders {\n  headers.delete =\n    headers.set =\n    headers.append =\n      () => {\n        throw new Error(`Cannot Mutate Immutatable Headers, use headers.clone to get a copy`);\n      };\n  upgradeHeaders(headers);\n  return headers as ImmutableHeaders;\n}\n\nexport function deepFreeze<T = unknown>(value: T): T {\n  if (value && (value as { [IS_FROZEN]?: true })[IS_FROZEN]) {\n    return value;\n  }\n  const _type = typeof value;\n  switch (_type) {\n    case 'boolean':\n    case 'string':\n    case 'number':\n    case 'symbol':\n    case 'undefined':\n    case 'bigint':\n      return value;\n    case 'function':\n      throw new Error(`Cannot deep-freeze a function`);\n    case 'object': {\n      const _niceType = niceTypeOf(value);\n      switch (_niceType) {\n        case 'array': {\n          if ((value as unknown[] & { [IS_COLLECTION]?: true })[IS_COLLECTION]) {\n            return value;\n          }\n          const arr = (value as unknown[]).map(deepFreeze);\n          arr[IS_FROZEN as unknown as number] = true;\n          return Object.freeze(arr) as T;\n        }\n        case 'null':\n          return value;\n        case 'object':\n          Object.keys(value as Record<string, unknown>).forEach((key) => {\n            try {\n              (value as Record<string, unknown>)[key] = deepFreeze((value as Record<string, unknown>)[key]) as object;\n            } catch {\n              // continue\n            }\n          });\n          (value as Record<string | symbol, unknown>)[IS_FROZEN] = true;\n          return Object.freeze(value);\n        case 'headers':\n          return freezeHeaders(value as Headers) as T;\n        case 'Collection':\n        case 'Store':\n        case 'AbortSignal':\n          return value;\n        case 'date':\n        case 'map':\n        case 'set':\n        case 'error':\n        case 'stream':\n        default:\n          // console.log(`Cannot deep-freeze ${_niceType}`);\n          return value;\n      }\n    }\n  }\n}\n\nfunction isMaybeContext(request: unknown) {\n  if (request && typeof request === 'object') {\n    const keys = Object.keys(request);\n    if (keys.length === 1 && keys[0] === 'request') {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction niceTypeOf(v: unknown) {\n  if (v === null) {\n    return 'null';\n  }\n  if (typeof v === 'string') {\n    return v ? 'non-empty-string' : 'empty-string';\n  }\n  if (!v) {\n    return typeof v;\n  }\n  if (Array.isArray(v)) {\n    return 'array';\n  }\n  if (v instanceof Date) {\n    return 'date';\n  }\n  if (v instanceof Map) {\n    return 'map';\n  }\n  if (v instanceof Set) {\n    return 'set';\n  }\n  if (v instanceof Error) {\n    return 'error';\n  }\n  if (v instanceof ReadableStream || v instanceof WritableStream || v instanceof TransformStream) {\n    return 'stream';\n  }\n  if (v instanceof Headers) {\n    return 'headers';\n  }\n  if (typeof v === 'object' && v.constructor && v.constructor.name !== 'Object') {\n    return v.constructor.name;\n  }\n  return typeof v;\n}\n\nfunction validateKey(key: string, value: unknown, errors: string[]) {\n  const schema = ValidKeys.get(key);\n  if (!schema && !IgnoredKeys.has(key)) {\n    errors.push(`InvalidKey: '${key}'`);\n    return;\n  }\n  if (schema) {\n    if (schema === BODY_TYPES) {\n      if (typeof value === 'string' || value instanceof ReadableStream) {\n        return;\n      }\n      const type = niceTypeOf(value);\n      if (schema.klass.includes(type)) {\n        return;\n      }\n      errors.push(\n        `InvalidValue: key 'body' should be a string or one of '${schema.klass.join(\"', '\")}', received ${\n          '<a value of type ' + niceTypeOf(value) + '>'\n        }`\n      );\n      return;\n    }\n    if (Array.isArray(schema)) {\n      if (!schema.includes(value as string)) {\n        errors.push(\n          `InvalidValue: key ${key} should be one of '${schema.join(\"', '\")}', received ${\n            typeof value === 'string' ? value : '<a value of type ' + niceTypeOf(value) + '>'\n          }`\n        );\n      }\n      return;\n    } else if (schema === 'json') {\n      try {\n        JSON.stringify(value);\n      } catch (e) {\n        errors.push(\n          `InvalidValue: key ${key} should be a JSON serializable value, but failed to serialize with Error - ${\n            (e as Error).message\n          }`\n        );\n      }\n      return;\n    } else if (schema === 'headers') {\n      if (!(value instanceof Headers)) {\n        errors.push(`InvalidValue: key ${key} should be an instance of Headers, received ${niceTypeOf(value)}`);\n      }\n      return;\n    } else if (schema === 'record') {\n      const _type = typeof value;\n      // record must extend plain object or Object.create(null)\n      if (!value || _type !== 'object' || (value.constructor && value.constructor !== Object)) {\n        errors.push(\n          `InvalidValue: key ${key} should be a dictionary of string keys to string values, received ${niceTypeOf(\n            value\n          )}`\n        );\n        return;\n      }\n      const keys = Object.keys(value);\n      keys.forEach((k) => {\n        const v: unknown = (value as Record<string, unknown>)[k];\n        if (typeof k !== 'string') {\n          errors.push(`\\tThe key ${String(k)} on ${key} should be a string key`);\n        } else if (typeof v !== 'string') {\n          errors.push(`\\tThe value of ${key}.${k} should be a string not ${niceTypeOf(v)}`);\n        }\n      });\n      return;\n    } else if (schema === 'string') {\n      if (typeof value !== 'string' || value.length === 0) {\n        errors.push(\n          `InvalidValue: key ${key} should be a non-empty string, received ${\n            typeof value === 'string' ? \"''\" : typeof value\n          }`\n        );\n      }\n      return;\n    } else if (schema === 'object') {\n      if (!value || Array.isArray(value) || typeof value !== 'object') {\n        errors.push(`InvalidValue: key ${key} should be an object`);\n      }\n      return;\n    } else if (schema === 'boolean') {\n      if (typeof value !== 'boolean') {\n        errors.push(`InvalidValue: key ${key} should be a boolean, received ${typeof value}`);\n      }\n      return;\n    } else if (schema === 'array') {\n      if (!Array.isArray(value)) {\n        errors.push(`InvalidValue: key ${key} should be an array, received ${typeof value}`);\n      }\n      return;\n    }\n  }\n}\n\nconst IgnoredKeys = new Set<string>([]);\n\nexport function assertValidRequest(\n  request: RequestInfo | Context,\n  isTopLevel: boolean\n): asserts request is RequestInfo {\n  if (DEBUG) {\n    // handle basic shape\n    if (!request) {\n      throw new Error(\n        `Expected ${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>) to be called with a request, but none was provided.`\n      );\n    }\n    if (Array.isArray(request) || typeof request !== 'object') {\n      throw new Error(\n        `The \\`request\\` passed to \\`${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>)\\` should be an object, received \\`${niceTypeOf(request)}\\``\n      );\n    }\n    if (Object.keys(request).length === 0) {\n      throw new Error(\n        `The \\`request\\` passed to \\`${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>)\\` was empty (\\`{}\\`). Requests need at least one valid key.`\n      );\n    }\n\n    // handle accidentally passing context entirely\n    if (request instanceof Context) {\n      throw new Error(\n        `Expected a request passed to \\`${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>)\\` but received the previous handler's context instead`\n      );\n    }\n    // handle Object.assign({}, context);\n    if (isMaybeContext(request)) {\n      throw new Error(\n        `Expected a request passed to \\`${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>)\\` but received an object with a request key instead.`\n      );\n    }\n\n    // handle schema\n    const keys = Object.keys(request) as Array<keyof RequestInfo>;\n    const validationErrors: string[] = [];\n    const isLegacyRequest = Boolean('op' in request && !request.url);\n    keys.forEach((key) => {\n      if (isLegacyRequest && key === 'data') {\n        return;\n      }\n      validateKey(key, request[key], validationErrors);\n    });\n    if (validationErrors.length) {\n      const error: Error & { errors: string[] } = new Error(\n        `Invalid Request passed to \\`${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>)\\`.\\n\\nThe following issues were found:\\n\\n\\t${validationErrors.join('\\n\\t')}`\n      ) as Error & { errors: string[] };\n      error.errors = validationErrors;\n      throw error;\n    }\n  }\n}\n"],"names":["PromiseCache","getOrSetUniversal","WeakMap","RequestMap","Map","setRequestResult","requestId","result","set","clearRequestResult","delete","getRequestResult","get","setPromiseResult","promise","getPromiseResult","IS_CACHE_HANDLER","getOrSetGlobal","Symbol","curryFuture","owner","inbound","outbound","setStream","getStream","then","doc","document","STRUCTURED","request","response","content","resolve","error","isDoc","god","stream","Error","e","Object","assign","message","getResponse","reject","ensureDoc","isError","enhanceReason","reason","DOMException","handleOutcome","controller","signal","aborted","isCacheHandler","handler","index","Boolean","executeNextHandler","wares","i","macroCondition","getGlobalConfig","WarpDrive","env","DEBUG","length","assertValidRequest","ContextOwner","next","r","nextCalled","_isCacheHandler","context","Context","outcome","_finalize","Promise","console","log","undefined","future","createFuture","isFuture","maybe","IS_FUTURE","createDeferred","res","rej","upgradePromise","abort","onFinalize","id","lid","deferred","cbs","finally","resolveStream","forEach","cb","fn","push","identifier","upgradeHeaders","headers","clone","Headers","toJSON","Array","from","cloneResponseProperties","ok","redirected","status","statusText","type","url","hasSetStream","hasSetResponse","hasSubscribers","constructor","isRoot","sizeHint","addEventListener","enhancedRequest","cacheOptions","SkipCache","deepFreeze","hasRequestedStream","hint","parseInt","setResponse","Response","responseData","_finalized","setIdentifier","test","BODY_TYPES","klass","ValidKeys","IS_FROZEN","IS_COLLECTION","for","freezeHeaders","append","value","_type","_niceType","niceTypeOf","arr","map","freeze","keys","key","isMaybeContext","v","isArray","Date","Set","ReadableStream","WritableStream","TransformStream","name","validateKey","errors","schema","IgnoredKeys","has","includes","join","JSON","stringify","k","String","isTopLevel","validationErrors","isLegacyRequest"],"mappings":"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"}