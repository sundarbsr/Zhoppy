{"version":3,"file":"fetch.js","sources":["../src/fetch.ts"],"sourcesContent":["/**\n * A basic Fetch Handler which converts a request into a\n * `fetch` call presuming the response to be `json`.\n *\n * ```ts\n * import Fetch from '@ember-data/request/fetch';\n *\n * manager.use([Fetch]);\n * ```\n *\n * @module @ember-data/request/fetch\n * @main @ember-data/request/fetch\n */\n\nimport { DEBUG } from '@warp-drive/build-config/env';\n\nimport { cloneResponseProperties, type Context } from './-private/context';\nimport type { HttpErrorProps } from './-private/utils';\n\ninterface FastbootRequest {\n  protocol: string;\n  host: string;\n}\ninterface FastBoot {\n  require(moduleName: string): unknown;\n  isFastBoot: boolean;\n  request: FastbootRequest;\n}\ndeclare global {\n  const FastBoot: undefined | FastBoot;\n}\n\n// Lazily close over fetch to avoid breaking Mirage\nconst _fetch: typeof fetch =\n  typeof fetch !== 'undefined'\n    ? (...args) => fetch(...args)\n    : typeof FastBoot !== 'undefined'\n      ? (...args) => (FastBoot.require('node-fetch') as typeof fetch)(...args)\n      : ((() => {\n          throw new Error('No Fetch Implementation Found');\n        }) as typeof fetch);\n\n// clones a response in a way that should still\n// allow it to stream\nfunction cloneResponse(response: Response, overrides: Partial<Response>) {\n  const props = cloneResponseProperties(response);\n  return new Response(response.body, Object.assign(props, overrides));\n}\n\nlet IS_MAYBE_MIRAGE = () => false;\nif (DEBUG) {\n  IS_MAYBE_MIRAGE = () =>\n    Boolean(\n      typeof window !== 'undefined' &&\n        ((window as { server?: { pretender: unknown } }).server?.pretender ||\n          window.fetch.toString().replace(/\\s+/g, '') !== 'function fetch() { [native code] }'.replace(/\\s+/g, ''))\n    );\n}\n\nconst MUTATION_OPS = new Set(['updateRecord', 'createRecord', 'deleteRecord']);\nconst ERROR_STATUS_CODE_FOR = new Map([\n  [400, 'Bad Request'],\n  [401, 'Unauthorized'],\n  [402, 'Payment Required'],\n  [403, 'Forbidden'],\n  [404, 'Not Found'],\n  [405, 'Method Not Allowed'],\n  [406, 'Not Acceptable'],\n  [407, 'Proxy Authentication Required'],\n  [408, 'Request Timeout'],\n  [409, 'Conflict'],\n  [410, 'Gone'],\n  [411, 'Length Required'],\n  [412, 'Precondition Failed'],\n  [413, 'Payload Too Large'],\n  [414, 'URI Too Long'],\n  [415, 'Unsupported Media Type'],\n  [416, 'Range Not Satisfiable'],\n  [417, 'Expectation Failed'],\n  [419, 'Page Expired'],\n  [420, 'Enhance Your Calm'],\n  [421, 'Misdirected Request'],\n  [422, 'Unprocessable Entity'],\n  [423, 'Locked'],\n  [424, 'Failed Dependency'],\n  [425, 'Too Early'],\n  [426, 'Upgrade Required'],\n  [428, 'Precondition Required'],\n  [429, 'Too Many Requests'],\n  [430, 'Request Header Fields Too Large'],\n  [431, 'Request Header Fields Too Large'],\n  [450, 'Blocked By Windows Parental Controls'],\n  [451, 'Unavailable For Legal Reasons'],\n  [500, 'Internal Server Error'],\n  [501, 'Not Implemented'],\n  [502, 'Bad Gateway'],\n  [503, 'Service Unavailable'],\n  [504, 'Gateway Timeout'],\n  [505, 'HTTP Version Not Supported'],\n  [506, 'Variant Also Negotiates'],\n  [507, 'Insufficient Storage'],\n  [508, 'Loop Detected'],\n  [509, 'Bandwidth Limit Exceeded'],\n  [510, 'Not Extended'],\n  [511, 'Network Authentication Required'],\n]);\n\n/**\n * A basic handler which converts a request into a\n * `fetch` call presuming the response to be `json`.\n *\n * ```ts\n * import Fetch from '@ember-data/request/fetch';\n *\n * manager.use([Fetch]);\n * ```\n *\n * @class Fetch\n * @public\n */\nconst Fetch = {\n  async request<T>(context: Context): Promise<T> {\n    let response: Response;\n\n    try {\n      response = await _fetch(context.request.url!, context.request);\n    } catch (e) {\n      if (e instanceof DOMException && e.name === 'AbortError') {\n        (e as HttpErrorProps).statusText = 'Aborted';\n        (e as HttpErrorProps).status = 20;\n        (e as HttpErrorProps).isRequestError = true;\n      } else {\n        (e as HttpErrorProps).statusText = 'Unknown Network Error';\n        (e as HttpErrorProps).status = 0;\n        (e as HttpErrorProps).isRequestError = true;\n      }\n      throw e;\n    }\n\n    const isError = !response.ok || response.status >= 400;\n    const op = context.request.op;\n    const isMutationOp = Boolean(op && MUTATION_OPS.has(op));\n\n    if (!isError && !isMutationOp && response.status !== 204 && !response.headers.has('date')) {\n      if (IS_MAYBE_MIRAGE()) {\n        response.headers.set('date', new Date().toUTCString());\n      } else {\n        const headers = new Headers(response.headers);\n        headers.set('date', new Date().toUTCString());\n        response = cloneResponse(response, {\n          headers,\n        });\n      }\n    }\n\n    context.setResponse(response);\n\n    if (response.status === 204) {\n      return null as T;\n    }\n\n    let text = '';\n    // if we are in a mirage context, we cannot support streaming\n    if (IS_MAYBE_MIRAGE()) {\n      text = await response.text();\n    } else {\n      const reader = response.body!.getReader();\n      const decoder = new TextDecoder();\n      let isStreaming = context.hasRequestedStream;\n      let stream: TransformStream | null = isStreaming ? new TransformStream() : null;\n      let writer = stream?.writable.getWriter();\n\n      if (isStreaming) {\n        // Listen for the abort event on the AbortSignal\n        context.request.signal?.addEventListener('abort', () => {\n          if (!isStreaming) {\n            return;\n          }\n          void stream!.writable.abort('Request Aborted');\n          void stream!.readable.cancel('Request Aborted');\n        });\n        context.setStream(stream!.readable);\n      }\n\n      while (true) {\n        // we manually read the stream instead of using `response.json()`\n        // or `response.text()` because if we need to stream the body\n        // we need to be able to pass the stream along efficiently.\n        const { done, value } = await reader.read();\n        if (done) {\n          if (isStreaming) {\n            isStreaming = false;\n            await writer!.ready;\n            await writer!.close();\n          }\n          break;\n        }\n        text += decoder.decode(value, { stream: true });\n\n        // if we are streaming, we want to pass the stream along\n        if (isStreaming) {\n          await writer!.ready;\n          await writer!.write(value);\n        } else if (context.hasRequestedStream) {\n          const encode = new TextEncoder();\n          isStreaming = true;\n          stream = new TransformStream();\n          // Listen for the abort event on the AbortSignal\n          // eslint-disable-next-line @typescript-eslint/no-loop-func\n          context.request.signal?.addEventListener('abort', () => {\n            if (!isStreaming) {\n              return;\n            }\n            void stream!.writable.abort('Request Aborted');\n            void stream!.readable.cancel('Request Aborted');\n          });\n          context.setStream(stream.readable);\n          writer = stream.writable.getWriter();\n          await writer.ready;\n          await writer.write(encode.encode(text));\n          await writer.ready;\n          await writer.write(value);\n        }\n      }\n\n      if (isStreaming) {\n        isStreaming = false;\n        await writer!.ready;\n        await writer!.close();\n      }\n    }\n    // if we are an error, we will want to throw\n    if (isError) {\n      let errorPayload: object | undefined;\n      try {\n        errorPayload = JSON.parse(text) as object;\n      } catch {\n        // void;\n      }\n      // attempt errors discovery\n      const errors = Array.isArray(errorPayload)\n        ? errorPayload\n        : isDict(errorPayload) && Array.isArray(errorPayload.errors)\n          ? errorPayload.errors\n          : null;\n\n      const statusText = response.statusText || ERROR_STATUS_CODE_FOR.get(response.status) || 'Unknown Request Error';\n      const msg = `[${response.status} ${statusText}] ${context.request.method ?? 'GET'} (${response.type}) - ${\n        response.url\n      }`;\n\n      const error = (errors ? new AggregateError(errors, msg) : new Error(msg)) as Error & {\n        content: object | undefined;\n      } & HttpErrorProps;\n      error.status = response.status;\n      error.statusText = statusText;\n      error.isRequestError = true;\n      error.code = error.status;\n      error.name = error.statusText.replaceAll(' ', '') + 'Error';\n      error.content = errorPayload;\n      throw error;\n    } else {\n      return JSON.parse(text) as T;\n    }\n  },\n};\n\nfunction isDict(v: unknown): v is Record<string, unknown> {\n  return v !== null && typeof v === 'object';\n}\n\nexport default Fetch;\n"],"names":["_fetch","fetch","args","FastBoot","require","Error","cloneResponse","response","overrides","props","cloneResponseProperties","Response","body","Object","assign","IS_MAYBE_MIRAGE","macroCondition","getGlobalConfig","WarpDrive","env","DEBUG","Boolean","window","server","pretender","toString","replace","MUTATION_OPS","Set","ERROR_STATUS_CODE_FOR","Map","Fetch","request","context","url","e","DOMException","name","statusText","status","isRequestError","isError","ok","op","isMutationOp","has","headers","set","Date","toUTCString","Headers","setResponse","text","reader","getReader","decoder","TextDecoder","isStreaming","hasRequestedStream","stream","TransformStream","writer","writable","getWriter","signal","addEventListener","abort","readable","cancel","setStream","done","value","read","ready","close","decode","write","encode","TextEncoder","errorPayload","JSON","parse","errors","Array","isArray","isDict","get","msg","method","type","error","AggregateError","code","replaceAll","content","v"],"mappings":"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"}