import{Stack as e,dict as t,EMPTY_STRING_ARRAY as l,EMPTY_ARRAY as n,enumerate as o,assign as r,reverse as a}from"@glimmer/util";import{InstructionEncoderImpl as i}from"@glimmer/encoder";import{ARG_SHIFT as s,MACHINE_MASK as u,$v0 as c,$fp as d,InternalComponentCapabilities as p,$s0 as m,$sp as h,$s1 as f,ContentType as y}from"@glimmer/vm";import{SexpOpcodes as b}from"@glimmer/wire-format";import{hasCapability as g}from"@glimmer/manager";const v=-536870913;function k(e){return(e|=0)<0?function(e){return e&v}(e):function(e){return~e}(e)}[1,-1].forEach((e=>{return t=k(e),(t|=0)>v?function(e){return~e}(t):function(e){return 536870912|e}(t);var t}));const w=33,A=34,S=35,L=36,N=61;let E;function H(e){return t=>{if(!function(e){return Array.isArray(e)&&2===e.length}(t))return!1;let l=t[0];return l===b.GetStrictKeyword||l===b.GetLexicalSymbol||l===e}}const C=H(b.GetFreeAsComponentHead),G=H(b.GetFreeAsModifierHead),B=H(b.GetFreeAsHelperHead),I=H(b.GetFreeAsComponentOrHelperHead);function x(e,t,l,n){let{symbols:{upvars:o}}=l,r=o[e[1]],a=t?.lookupBuiltInHelper?.(r)??null;return n.helper(a,r)}const D=1004,M=1005,O=1010,T=1e3,V=1001,F=1002;function Y(e){return{type:1,value:e}}function K(e){return{type:5,value:e}}function R(e){return{type:7,value:e}}function W(e){return{type:8,value:e}}class j{label(e,t){this.labels[e]=t}target(e,t){this.targets.push({at:e,target:t})}patch(e){let{targets:t,labels:l}=this;for(const{at:n,target:o}of t){let t=l[o]-n;e.getbyaddr(n),e.setbyaddr(n,t)}}constructor(){this.labels=t(),this.targets=[]}}function z(e,t,l,n){let{program:{constants:o},resolver:r}=t;if(function(e){return e<1e3}(n[0])){let[t,...l]=n;e.push(o,t,...l)}else switch(n[0]){case T:return e.label(n[1]);case V:return e.startLabels();case F:return e.stopLabels();case D:return function(e,t,l,[,n,o]){if(C(n),n[0]===b.GetLexicalSymbol){let{scopeValues:e,owner:r,symbols:{lexical:a}}=l,i=e[n[1]];o(t.component(i,r,!1,a?.at(n[1])))}else{let{symbols:{upvars:r},owner:a}=l,i=r[n[1]],s=e?.lookupComponent?.(i,a)??null;o(t.resolvedComponent(s,i))}}(r,o,l,n);case 1003:return function(e,t,l,[,n,o]){G(n);let r=n[0];if(r===b.GetLexicalSymbol){let{scopeValues:e,symbols:{lexical:r}}=l,a=e[n[1]];o(t.modifier(a,r?.at(n[1])??void 0))}else if(r===b.GetStrictKeyword){let{symbols:{upvars:r}}=l,a=r[n[1]],i=e?.lookupBuiltInModifier?.(a)??null;o(t.modifier(i,a))}else{let{symbols:{upvars:r},owner:a}=l,i=r[n[1]],s=e?.lookupModifier?.(i,a)??null;o(t.modifier(s))}}(r,o,l,n);case M:return function(e,t,l,[,n,o]){B(n);let r=n[0];if(r===b.GetLexicalSymbol){let{scopeValues:e}=l,r=e[n[1]];o(t.helper(r))}else if(r===b.GetStrictKeyword)o(x(n,e,l,t));else{let{symbols:{upvars:r},owner:a}=l,i=r[n[1]],s=e?.lookupHelper?.(i,a)??null;o(t.helper(s,i))}}(r,o,l,n);case 1007:return function(e,t,l,[,n,{ifComponent:o,ifHelper:r}]){I(n);let a=n[0];if(a===b.GetLexicalSymbol){let{scopeValues:e,owner:a,symbols:{lexical:i}}=l,s=e[n[1]],u=t.component(s,a,!0,i?.at(n[1]));if(null!==u)return void o(u);r(t.helper(s,null,!0))}else if(a===b.GetStrictKeyword)r(x(n,e,l,t));else{let{symbols:{upvars:a},owner:i}=l,s=a[n[1]],u=e?.lookupComponent?.(s,i)??null;if(null!==u)o(t.resolvedComponent(u,s));else{let l=e?.lookupHelper?.(s,i)??null;r(t.helper(l,s))}}}(r,o,l,n);case 1008:return function(e,t,l,[,n,{ifComponent:o,ifHelper:r,ifValue:a}]){I(n);let i=n[0];if(i===b.GetLexicalSymbol){let{scopeValues:e,owner:i,symbols:{lexical:s}}=l,u=e[n[1]];if("function"!=typeof u&&("object"!=typeof u||null===u))return void a(t.value(u));let c=t.component(u,i,!0,s?.at(n[1]));if(null!==c)return void o(c);let d=t.helper(u,null,!0);if(null!==d)return void r(d);a(t.value(u))}else if(i===b.GetStrictKeyword)r(x(n,e,l,t));else{let{symbols:{upvars:a},owner:i}=l,s=a[n[1]],u=e?.lookupComponent?.(s,i)??null;if(null!==u)return void o(t.resolvedComponent(u,s));let c=e?.lookupHelper?.(s,i)??null;null!==c&&r(t.helper(c,s))}}(r,o,l,n);case O:{let[,e,t]=n;t(l.symbols.upvars[e],l.moduleName);break}case 1011:{let[,e,t]=n,r=l.scopeValues[e];t(o.value(r));break}default:throw new Error(`Unexpected high level opcode ${n[0]}`)}}class U{constructor(t,l,n){this.heap=t,this.meta=l,this.stdlib=n,this.labelsStack=new e,this.encoder=new i([]),this.errors=[],this.handle=t.malloc()}error(e){this.encoder.encode(30,0),this.errors.push(e)}commit(e){let t=this.handle;return this.heap.pushMachine(5),this.heap.finishMalloc(t,e),(l=this.errors)&&l.length>0?{errors:this.errors,handle:t}:t;var l}push(e,t,...l){let{heap:n}=this;var o;let r=t|((o=t)>=0&&o<=15?u:0)|l.length<<s;n.pushRaw(r);for(let t=0;t<l.length;t++){let o=l[t];n.pushRaw(this.operand(e,o))}}operand(e,t){if("number"==typeof t)return t;if("object"==typeof t&&null!==t){if(Array.isArray(t))return e.array(t);switch(t.type){case 1:return this.currentLabels.target(this.heap.offset,t.value),-1;case 2:return e.value(this.meta.isStrictMode);case 3:case 6:case 7:case 8:return e.value(t.value);case 4:return e.value((l=t.value,o=this.meta,new He(l[0],o,{parameters:l[1]||n})));case 5:return this.stdlib[t.value]}}var l,o;return e.value(t)}get currentLabels(){return this.labelsStack.current}label(e){this.currentLabels.label(e,this.heap.offset+1)}startLabels(){this.labelsStack.push(new j)}stopLabels(){this.labelsStack.pop().patch(this.heap)}}function _(e,t){return{evaluation:e,encoder:new U(e.program.heap,t,e.stdlib),meta:t}}class ${add(e,t){this.names[e]=this.funcs.push(t)-1}compile(e,t){let l=t[0],n=this.names[l],o=this.funcs[n];t[0],o(e,t)}constructor(){this.names={},this.funcs=[]}}const J=new $;function P(e,t){if(void 0!==t&&0!==t.length)for(let l=0;l<t.length;l++)e(22,t[l])}function q(e,t){Array.isArray(t)?J.compile(e,t):(X(e,t),e(31))}function Q(e,t){X(e,t),e(31)}function X(e,t){let l=t;var n;"number"==typeof l&&(l=(n=l)%1==0&&n<=536870911&&n>=-536870912?k(l):function(e){return{type:6,value:e}}(l)),e(30,l)}function Z(e,t,l,n){e(0),ie(e,l,n,!1),e(16,t),e(1),e(L,c)}function ee(e,t,l,n){e(0),ie(e,t,l,!1),e(w,d,1),e(107),n?(e(L,c),n(),e(1),e(A,1)):(e(1),e(A,1),e(L,c))}function te(e,t,l,n,o){e(0),ie(e,n,o,!1),e(86),q(e,l),e(77,t,{type:2,value:void 0}),e(1),e(L,c)}function le(e,t,l){ie(e,l,null,!0),e(23,t),e(24),e(N),e(64),e(40),e(1)}function ne(e,t){!function(e,t){null!==t?e(63,R({parameters:t})):X(e,null)}(e,t&&t[1]),e(62),ae(e,t)}function oe(e,t){e(0),ae(e,t),e(N),e(2),e(1)}function re(e,t,l){let n=t[1],o=n.length,r=Math.min(l,o);if(0!==r){if(e(0),r){e(39);for(let t=0;t<r;t++)e(w,d,l-t),e(19,n[t])}ae(e,t),e(N),e(2),r&&e(40),e(1)}else oe(e,t)}function ae(e,t){null===t?X(e,null):e(28,{type:4,value:t})}function ie(e,t,n,o){if(null===t&&null===n)return void e(83);let r=se(e,t)<<4;o&&(r|=8);let a=l;if(n){a=n[0];let t=n[1];for(let l=0;l<t.length;l++)q(e,t[l])}e(82,a,l,r)}function se(e,t){if(null===t)return 0;for(let l=0;l<t.length;l++)q(e,t[l]);return t.length}function ue(e){let[,t,l,n]=e.block;return{symbols:{locals:t,upvars:l,lexical:n},scopeValues:e.scope?.()??null,isStrictMode:e.isStrictMode,moduleName:e.moduleName,owner:e.owner,size:t.length}}J.add(b.Concat,((e,[,t])=>{for(let l of t)q(e,l);e(27,t.length)})),J.add(b.Call,((e,[,t,l,n])=>{B(t)?e(M,t,(t=>{Z(e,t,l,n)})):(q(e,t),ee(e,l,n))})),J.add(b.Curry,((e,[,t,l,n,o])=>{te(e,l,t,n,o)})),J.add(b.GetSymbol,((e,[,t,l])=>{e(21,t),P(e,l)})),J.add(b.GetLexicalSymbol,((e,[,t,l])=>{e(1011,t,(t=>{e(29,t),P(e,l)}))})),J.add(b.GetStrictKeyword,((e,t)=>{e(O,t[1],(()=>{e(M,t,(t=>{Z(e,t,null,null)}))}))})),J.add(b.GetFreeAsHelperHead,((e,t)=>{e(O,t[1],(()=>{e(M,t,(t=>{Z(e,t,null,null)}))}))})),J.add(b.Undefined,(e=>Q(e,void 0))),J.add(b.HasBlock,((e,[,t])=>{q(e,t),e(25)})),J.add(b.HasBlockParams,((e,[,t])=>{q(e,t),e(24),e(N),e(26)})),J.add(b.IfInline,((e,[,t,l,n])=>{q(e,n),q(e,l),q(e,t),e(109)})),J.add(b.Not,((e,[,t])=>{q(e,t),e(110)})),J.add(b.GetDynamicVar,((e,[,t])=>{q(e,t),e(111)})),J.add(b.Log,((e,[,t])=>{e(0),ie(e,t,null,!1),e(112),e(1),e(L,c)}));class ce{constructor(e){this.blocks=e,this.names=e?Object.keys(e):[]}get(e){return this.blocks&&this.blocks[e]||null}has(e){let{blocks:t}=this;return null!==t&&e in t}with(e,t){let{blocks:l}=this;return new ce(l?r({},l,{[e]:t}):{[e]:t})}get hasAny(){return null!==this.blocks}}const de=new ce(null);function pe(e){if(null===e)return de;let l=t(),[n,r]=e;for(const[e,t]of o(n))l[t]=r[e];return new ce(l)}function me(e,t,l){let n=[],o=0;l((function(e,t){n.push({match:e,callback:t,label:"CLAUSE"+o++})})),e(69,1),t(),e(V);for(let t of n.slice(0,-1))e(67,Y(t.label),t.match);for(let t=n.length-1;t>=0;t--){let l=n[t];e(T,l.label),e(A,1),l.callback(),0!==t&&e(4,Y("END"))}e(T,"END"),e(F),e(70)}function he(e,t,l){e(V),e(0),e(6,Y("ENDINITIAL")),e(69,t()),l(),e(T,"FINALLY"),e(70),e(5),e(T,"ENDINITIAL"),e(1),e(F)}function fe(e,t,l,n){return he(e,t,(()=>{e(66,Y("ELSE")),l(),e(4,Y("FINALLY")),e(T,"ELSE"),void 0!==n&&n()}))}const ye="&attrs";function be(e,t,n,o,r,i){let{compilable:s,capabilities:u,handle:c}=t,d=n?[n,[]]:null,f=pe(i);s?(e(78,c),function(e,{capabilities:t,layout:n,elementBlock:o,positional:r,named:i,blocks:s}){let{symbolTable:u}=n;if(g(t,p.prepareArgs))return void ve(e,{capabilities:t,elementBlock:o,positional:r,named:i,atNames:!0,blocks:s,layout:n});e(L,m),e(w,h,1),e(S,m),e(0);let{symbols:c}=u,d=[],f=[],y=[],b=s.names;if(null!==o){let t=c.indexOf(ye);-1!==t&&(ne(e,o),d.push(t))}for(const t of b){let l=c.indexOf(`&${t}`);-1!==l&&(ne(e,s.get(t)),d.push(l))}if(g(t,p.createArgs)){let t=se(e,r)<<4;t|=8;let n=l;if(null!==i){n=i[0];let t=i[1];for(let l=0;l<t.length;l++){let o=c.indexOf(n[l]);q(e,t[l]),f.push(o)}}e(82,n,l,t),f.push(-1)}else if(null!==i){let t=i[0],l=i[1];for(let n=0;n<l.length;n++){let o=t[n],r=c.indexOf(o);-1!==r&&(q(e,l[n]),f.push(r),y.push(o))}}e(97,m),g(t,p.dynamicScope)&&e(59),g(t,p.createInstance)&&e(87,0|s.has("default")),e(88,m),g(t,p.createArgs)?e(90,m):e(90,m,y),e(37,c.length+1,Object.keys(s).length>0?1:0),e(19,0);for(const t of a(f))-1===t?e(A,1):e(19,t+1);null!==r&&e(A,r.length);for(const t of a(d))e(20,t+1);e(28,W(n)),e(N),e(2),e(100,m),e(1),e(40),g(t,p.dynamicScope)&&e(60),e(98),e(S,m)}(e,{capabilities:u,layout:s,elementBlock:d,positional:o,named:r,blocks:f})):(e(78,c),ve(e,{capabilities:u,elementBlock:d,positional:o,named:r,atNames:!0,blocks:f}))}function ge(e,t,l,n,o,r,a,i){let s=l?[l,[]]:null,u=pe(r);he(e,(()=>(q(e,t),e(w,h,0),2)),(()=>{e(66,Y("ELSE")),i?e(81):e(80,{type:2,value:void 0}),e(79),ve(e,{capabilities:!0,elementBlock:s,positional:n,named:o,atNames:a,blocks:u}),e(T,"ELSE")}))}function ve(e,{capabilities:t,elementBlock:l,positional:o,named:r,atNames:a,blocks:i,layout:s}){let u=!!i,c=!0===t||g(t,p.prepareArgs)||!(!r||0===r[0].length),d=i.with("attrs",l);e(L,m),e(w,h,1),e(S,m),e(0),function(e,t,l,o,r){let a=o.names;for(const t of a)ne(e,o.get(t));let i=se(e,t)<<4;r&&(i|=8),o.hasAny&&(i|=7);let s=n;if(l){s=l[0];let t=l[1];for(let l=0;l<t.length;l++)q(e,t[l])}e(82,s,a,i)}(e,o,r,d,a),e(85,m),ke(e,d.has("default"),u,c,(()=>{s?(e(63,R(s.symbolTable)),e(28,W(s)),e(N)):e(92,m),e(95,m)})),e(S,m)}function ke(e,t,l,n,o=null){e(97,m),e(59),e(87,0|t),o&&o(),e(88,m),e(90,m),e(38,m),e(19,0),n&&e(17,m),l&&e(18,m),e(A,1),e(96,m),e(100,m),e(1),e(40),e(60),e(98)}const we=new $,Ae=["class","id","value","name","type","style","href"],Se=["div","span","p","a"];function Le(e){return"string"==typeof e?e:Se[e]}function Ne(e){return"string"==typeof e?e:Ae[e]}function Ee(e){return null===e?null:[e[0].map((e=>`@${e}`)),e[1]]}we.add(b.Comment,((e,t)=>e(42,t[1]))),we.add(b.CloseElement,(e=>e(55))),we.add(b.FlushElement,(e=>e(54))),we.add(b.Modifier,((e,[,t,l,n])=>{G(t)?e(1003,t,(t=>{e(0),ie(e,l,n,!1),e(57,t),e(1)})):(q(e,t),e(0),ie(e,l,n,!1),e(w,d,1),e(108),e(1))})),we.add(b.StaticAttr,((e,[,t,l,n])=>{e(51,Ne(t),l,n??null)})),we.add(b.StaticComponentAttr,((e,[,t,l,n])=>{e(105,Ne(t),l,n??null)})),we.add(b.DynamicAttr,((e,[,t,l,n])=>{q(e,l),e(52,Ne(t),!1,n??null)})),we.add(b.TrustingDynamicAttr,((e,[,t,l,n])=>{q(e,l),e(52,Ne(t),!0,n??null)})),we.add(b.ComponentAttr,((e,[,t,l,n])=>{q(e,l),e(53,Ne(t),!1,n??null)})),we.add(b.TrustingComponentAttr,((e,[,t,l,n])=>{q(e,l),e(53,Ne(t),!0,n??null)})),we.add(b.OpenElement,((e,[,t])=>{e(48,Le(t))})),we.add(b.OpenElementWithSplat,((e,[,t])=>{e(89),e(48,Le(t))})),we.add(b.Component,((e,[,t,l,n,o])=>{C(t)?e(D,t,(t=>{be(e,t,l,null,n,o)})):ge(e,t,l,null,n,o,!0,!0)})),we.add(b.Yield,((e,[,t,l])=>le(e,t,l))),we.add(b.AttrSplat,((e,[,t])=>le(e,t,null))),we.add(b.Debugger,((e,[,t,l,n])=>{e(103,function(e,t,l){return{type:3,value:{locals:e,upvars:t,lexical:l}}}(t,l,n))})),we.add(b.Append,((e,[,t])=>{if(Array.isArray(t))if(I(t))e(1008,t,{ifComponent(t){be(e,t,null,null,null,null)},ifHelper(t){e(0),Z(e,t,null,null),e(3,K("cautious-non-dynamic-append")),e(1)},ifValue(t){e(0),e(29,t),e(3,K("cautious-non-dynamic-append")),e(1)}});else if(t[0]===b.Call){let[,l,n,o]=t;I(l)?e(1007,l,{ifComponent(t){be(e,t,null,n,Ee(o),null)},ifHelper(t){e(0),Z(e,t,n,o),e(3,K("cautious-non-dynamic-append")),e(1)}}):me(e,(()=>{q(e,l),e(106)}),(t=>{t(y.Component,(()=>{e(81),e(79),ve(e,{capabilities:!0,elementBlock:null,positional:n,named:o,atNames:!1,blocks:pe(null)})})),t(y.Helper,(()=>{ee(e,n,o,(()=>{e(3,K("cautious-non-dynamic-append"))}))}))}))}else e(0),q(e,t),e(3,K("cautious-append")),e(1);else e(41,null==t?"":String(t))})),we.add(b.TrustingAppend,((e,[,t])=>{Array.isArray(t)?(e(0),q(e,t),e(3,K("trusting-append")),e(1)):e(41,null==t?"":String(t))})),we.add(b.Block,((e,[,t,l,n,o])=>{C(t)?e(D,t,(t=>{be(e,t,null,l,Ee(n),o)})):ge(e,t,null,l,n,o,!1,!1)})),we.add(b.InElement,((e,[,t,l,n,o])=>{fe(e,(()=>(q(e,l),void 0===o?Q(e,void 0):q(e,o),q(e,n),e(w,h,0),4)),(()=>{e(50),oe(e,t),e(56)}))})),we.add(b.If,((e,[,t,l,n])=>fe(e,(()=>(q(e,t),e(71),1)),(()=>{oe(e,l)}),n?()=>{oe(e,n)}:void 0))),we.add(b.Each,((e,[,t,l,n,o])=>he(e,(()=>(l?q(e,l):Q(e,null),q(e,t),2)),(()=>{e(72,Y("BODY"),Y("ELSE")),e(0),e(w,d,1),e(6,Y("ITER")),e(T,"ITER"),e(74,Y("BREAK")),e(T,"BODY"),re(e,n,2),e(A,2),e(4,Y("FINALLY")),e(T,"BREAK"),e(1),e(73),e(4,Y("FINALLY")),e(T,"ELSE"),o&&oe(e,o)})))),we.add(b.Let,((e,[,t,l])=>{re(e,l,se(e,t))})),we.add(b.WithDynamicVars,((e,[,t,l])=>{if(t){let[n,o]=t;se(e,o),function(e,t,l){e(59),e(58,t),l(),e(60)}(e,n,(()=>{oe(e,l)}))}else oe(e,l)})),we.add(b.InvokeComponent,((e,[,t,l,n,o])=>{C(t)?e(D,t,(t=>{be(e,t,null,l,Ee(n),o)})):ge(e,t,null,l,n,o,!1,!1)}));class He{constructor(e,t,l,n="plain block"){this.statements=e,this.meta=t,this.symbolTable=l,this.moduleName=n,this.compiled=null}compile(e){return function(e,t){if(null!==e.compiled)return e.compiled;e.compiled=-1;let{statements:l,meta:n}=e,o=Ge(l,n,t);return e.compiled=o,o}(this,e)}}function Ce(e,t){let[l,n]=e.block;return new He(l,ue(e),{symbols:n},t)}function Ge(e,t,l){let n=we,o=_(l,t),{encoder:r,evaluation:a}=o;function i(...e){z(r,a,t,e)}for(const t of e)n.compile(i,t);return o.encoder.commit(t.size)}const Be={dynamicLayout:!0,dynamicTag:!0,prepareArgs:!0,createArgs:!0,attributeHook:!1,elementHook:!1,dynamicScope:!0,createCaller:!1,updateHook:!0,createInstance:!0,wrapped:!1,willDestroy:!1,hasSubOwner:!1},Ie={dynamicLayout:!1,dynamicTag:!1,prepareArgs:!1,createArgs:!1,attributeHook:!1,elementHook:!1,dynamicScope:!1,createCaller:!1,updateHook:!1,createInstance:!1,wrapped:!1,willDestroy:!1,hasSubOwner:!1};class xe{constructor(e,t,l,n,o){this.main=e,this.trustingGuardedAppend=t,this.cautiousGuardedAppend=l,this.trustingNonDynamicAppend=n,this.cautiousNonDynamicAppend=o}get"trusting-append"(){return this.trustingGuardedAppend}get"cautious-append"(){return this.cautiousGuardedAppend}get"trusting-non-dynamic-append"(){return this.trustingNonDynamicAppend}get"cautious-non-dynamic-append"(){return this.cautiousNonDynamicAppend}getAppend(e){return e?this.trustingGuardedAppend:this.cautiousGuardedAppend}}function De(e,t,l){me(e,(()=>e(76)),(n=>{n(y.String,(()=>{t?(e(68),e(43)):e(47)})),"number"==typeof l?(n(y.Component,(()=>{e(81),e(79),function(e){e(L,m),e(w,h,1),e(S,m),e(0),e(83),e(85,m),ke(e,!1,!1,!0,(()=>{e(92,m),e(95,m)})),e(S,m)}(e)})),n(y.Helper,(()=>{ee(e,null,null,(()=>{e(3,l)}))}))):(n(y.Component,(()=>{e(47)})),n(y.Helper,(()=>{e(47)}))),n(y.SafeString,(()=>{e(68),e(44)})),n(y.Fragment,(()=>{e(68),e(45)})),n(y.Node,(()=>{e(68),e(46)}))}))}function Me(e){let t=Te(e,(e=>function(e){e(75,m),ke(e,!1,!1,!0)}(e))),l=Te(e,(e=>De(e,!0,null))),n=Te(e,(e=>De(e,!1,null))),o=Te(e,(e=>De(e,!0,l))),r=Te(e,(e=>De(e,!1,n)));return new xe(t,o,r,l,n)}const Oe={symbols:{locals:null,upvars:null},moduleName:"stdlib",scopeValues:null,isStrictMode:!0,owner:null,size:0};function Te(e,t){let l=new U(e.program.heap,Oe);t((function(...t){z(l,e,Oe,t)}));let n=l.commit(0);if("number"!=typeof n)throw new Error("Unexpected errors compiling std");return n}class Ve{constructor({constants:e,heap:t},l,n){this.constants=e,this.heap=t,this.resolver=n.resolver,this.createOp=l,this.env=n.env,this.program=n.program,this.stdlib=Me(this)}}class Fe{constructor(e,t){this.layout=e,this.moduleName=t,this.compiled=null;let{block:l}=e,[,n]=l;n=n.slice();let o=n.indexOf(ye);this.attrsBlockNumber=-1===o?n.push(ye):o+1,this.symbolTable={symbols:n},this.meta=ue(e)}compile(e){if(null!==this.compiled)return this.compiled;let t=ue(this.layout),l=_(e,t),{encoder:n,evaluation:o}=l;var r,a,i;r=function(...e){z(n,o,t,e)},a=this.layout,i=this.attrsBlockNumber,r(V),function(e,t,l){e(L,t),l(),e(S,t)}(r,f,(()=>{r(91,m),r(31),r(w,h,0)})),r(66,Y("BODY")),r(L,f),r(89),r(49),r(99,m),le(r,i,null),r(54),r(T,"BODY"),oe(r,[a.block[0],[]]),r(L,f),r(66,Y("END")),r(55),r(T,"END"),r(S,f),r(F);let s=l.encoder.commit(t.size);return"number"!=typeof s||(this.compiled=s),s}}let Ye=0,Ke={cacheHit:0,cacheMiss:0};function Re({id:e,moduleName:t,block:l,scope:n,isStrictMode:o}){let r,a=e||"client-"+Ye++,i=null,s=new WeakMap,u=e=>{if(void 0===r&&(r=JSON.parse(l)),void 0===e)return null===i?(Ke.cacheMiss++,i=new We({id:a,block:r,moduleName:t,owner:null,scope:n,isStrictMode:o})):Ke.cacheHit++,i;let u=s.get(e);return void 0===u?(Ke.cacheMiss++,u=new We({id:a,block:r,moduleName:t,owner:e,scope:n,isStrictMode:o}),s.set(e,u)):Ke.cacheHit++,u};return u.__id=a,u.__meta={moduleName:t},u}class We{constructor(e){this.parsedLayout=e,this.result="ok",this.layout=null,this.wrappedLayout=null}get moduleName(){return this.parsedLayout.moduleName}get id(){return this.parsedLayout.id}get referrer(){return{moduleName:this.parsedLayout.moduleName,owner:this.parsedLayout.owner}}asLayout(){return this.layout?this.layout:this.layout=Ce(r({},this.parsedLayout),this.moduleName)}asWrappedLayout(){return this.wrappedLayout?this.wrappedLayout:this.wrappedLayout=new Fe(r({},this.parsedLayout),this.moduleName)}}export{Be as DEFAULT_CAPABILITIES,de as EMPTY_BLOCKS,Ve as EvaluationContextImpl,Ie as MINIMAL_CAPABILITIES,xe as StdLib,Fe as WrappedBuilder,Ce as compilable,Ge as compileStatements,Me as compileStd,E as debugCompiler,oe as invokeStaticBlock,re as invokeStaticBlockWithStack,ue as meta,Ke as templateCacheCounters,_ as templateCompilationContext,Re as templateFactory};
//# sourceMappingURL=index.js.map
